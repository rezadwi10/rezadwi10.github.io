<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>How to Query</title>
<meta name="description" content="My daily notes as a Software Engineer">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="https://rezadwi10.github.io/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="https://rezadwi10.github.io/css/font-awesome.min.css">
<link rel="stylesheet" href="https://rezadwi10.github.io/css/owl.carousel.css">
<link rel="stylesheet" href="https://rezadwi10.github.io/css/owl.theme.css">


  <link href="https://rezadwi10.github.io/css/style.pink.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://rezadwi10.github.io/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://rezadwi10.github.io/img/favicon.png">


</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <h1 class="sidebar-heading"><a href="https://rezadwi10.github.io/">TLDR;</a></h1>
    
      <p class="sidebar-p">Software Engineer, currently based on Jakarta</p>
    
      <p class="sidebar-p">This site contains my daily notes as a Software Engineer who always forgetting what I've done to the code.</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="https://rezadwi10.github.io/posts/">Posts</a></li>
      
        <li><a href="https://rezadwi10.github.io/about/">About</a></li>
      
    </ul>
    <p class="social">
  
  
  
  <a href="https://twitter.com/rezadwi10" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  <a href="https://www.linkedin.com/in/reza-dwi-saputra/" data-animate-hover="pulse" class="external">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
  
  <a href="https://github.com/rezadwi10" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2019 Reza Dwi
        
        | Template by <a href="https://bootstrapious.com/free-templates" class="external">Bootstrapious.com</a>

&amp; ported to Hugo by <a href="https://github.com/kishaningithub">Kishan B</a>

      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://rezadwi10.github.io/">TLDR;</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>How to Query</h1>
         <p>Here&rsquo;s a brief summary, what i always do when asssigned to write time-consuming process in oracle SQL.</p>

<h3 id="1-write-working-query">1. Write working query</h3>

<p>Write working query like below.</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#069;font-weight:bold">SELECT</span>
  TLF.FILE_NAME,
  TLF.AUTH_TYP <span style="color:#069;font-weight:bold">AS</span> MTI, 
  SUBSTR(TLF.AUTH_TRAN_CDE_R, <span style="color:#f60">1</span>, <span style="color:#f60">2</span>) <span style="color:#069;font-weight:bold">AS</span> TRX_CDE, 
  TLF.AUTH_RESPONDER <span style="color:#069;font-weight:bold">AS</span> RESPONDER, 
  TLF.AUTH_ORIGINATOR <span style="color:#069;font-weight:bold">AS</span> ORIGINATOR,
  <span style="color:#069;font-weight:bold">COUNT</span>(<span style="color:#555">*</span>) <span style="color:#069;font-weight:bold">AS</span> TOTAL_TRX
<span style="color:#069;font-weight:bold">FROM</span> GGSDEV.TLF TLF
<span style="color:#069;font-weight:bold">WHERE</span> <span style="color:#f60">1</span><span style="color:#555">=</span><span style="color:#f60">1</span>
  <span style="color:#069;font-weight:bold">AND</span> SUBSTR(TLF.FILE_NAME, <span style="color:#555">-</span><span style="color:#f60">6</span>) <span style="color:#555">=</span> <span style="color:#c30">&#39;160907&#39;</span>
  <span style="color:#069;font-weight:bold">AND</span> TLF.HEAD_REC_TYP <span style="color:#555">=</span> <span style="color:#c30">&#39;01&#39;</span> <span style="color:#09f;font-style:italic">-- 01 = CODE FOR CUSTOMER TRANSACTION, SEE DDL TLF/PTLF IN B24
</span><span style="color:#09f;font-style:italic"></span>  <span style="color:#069;font-weight:bold">AND</span> TLF.AUTH_TYP <span style="color:#069;font-weight:bold">IN</span> (<span style="color:#069;font-weight:bold">SELECT</span> MSG_TYP <span style="color:#069;font-weight:bold">FROM</span> TBP_ATM_MSG_TYP <span style="color:#069;font-weight:bold">WHERE</span> FLAG <span style="color:#555">=</span> <span style="color:#c30">&#39;Y&#39;</span>)
  <span style="color:#069;font-weight:bold">AND</span> TLF.AUTH_TRAN_CDE_R <span style="color:#555">=</span> <span style="color:#c30">&#39;500000&#39;</span>
  <span style="color:#069;font-weight:bold">AND</span> TLF.Q1_UTIL_CDE <span style="color:#069;font-weight:bold">IN</span> (<span style="color:#069;font-weight:bold">SELECT</span> UTIL_CDE <span style="color:#069;font-weight:bold">FROM</span> TBP_ATM_UTIL_CDE <span style="color:#069;font-weight:bold">WHERE</span> FLAG <span style="color:#555">=</span> <span style="color:#c30">&#39;Y&#39;</span>)
<span style="color:#069;font-weight:bold">GROUP</span> <span style="color:#069;font-weight:bold">BY</span> 
  TLF.FILE_NAME,
  TLF.AUTH_TYP,
  SUBSTR(TLF.AUTH_TRAN_CDE_R, <span style="color:#f60">1</span>, <span style="color:#f60">2</span>),
  TLF.AUTH_RESPONDER,
  TLF.AUTH_ORIGINATOR, 
  TLF.Q1_UTIL_CDE</code></pre></div>

<p>not so complicated but <strong>it might</strong> consume <em>resource</em> so much. TLF is a table that stores retail transactions
from a channel and contains millions row with 5 days retention.</p>

<blockquote>
<p>developers must have that feeling for heavy task process</p>
</blockquote>

<p>skip this part <em>or just copy the most complicated-long-heavy-tasks query from your plsql</em></p>

<h3 id="2-check-oracle-s-scenario">2. Check oracle&rsquo;s scenario</h3>

<p>Using CBO (Cost Based Optimizer) method, and check what steps oracle will do to your query. Add
<code>explain plan for</code> before query:
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#069;font-weight:bold">EXPLAIN</span> PLAN <span style="color:#069;font-weight:bold">FOR</span>
<span style="color:#069;font-weight:bold">SELECT</span>
  TLF.FILE_NAME,
  TLF.AUTH_TYP <span style="color:#069;font-weight:bold">AS</span> MTI, 
  SUBSTR(TLF.AUTH_TRAN_CDE_R, <span style="color:#f60">1</span>, <span style="color:#f60">2</span>) <span style="color:#069;font-weight:bold">AS</span> TRX_CDE, 
  TLF.AUTH_RESPONDER <span style="color:#069;font-weight:bold">AS</span> RESPONDER, 
  TLF.AUTH_ORIGINATOR <span style="color:#069;font-weight:bold">AS</span> ORIGINATOR,
  <span style="color:#069;font-weight:bold">COUNT</span>(<span style="color:#555">*</span>) <span style="color:#069;font-weight:bold">AS</span> TOTAL_TRX
<span style="color:#069;font-weight:bold">FROM</span> GGSDEV.TLF TLF
<span style="color:#069;font-weight:bold">WHERE</span> <span style="color:#f60">1</span><span style="color:#555">=</span><span style="color:#f60">1</span>
  <span style="color:#069;font-weight:bold">AND</span> SUBSTR(TLF.FILE_NAME, <span style="color:#555">-</span><span style="color:#f60">6</span>) <span style="color:#555">=</span> <span style="color:#c30">&#39;160907&#39;</span>
  <span style="color:#069;font-weight:bold">AND</span> TLF.HEAD_REC_TYP <span style="color:#555">=</span> <span style="color:#c30">&#39;01&#39;</span> <span style="color:#09f;font-style:italic">-- 01 = CODE FOR CUSTOMER TRANSACTION, SEE DDL TLF/PTLF IN B24
</span><span style="color:#09f;font-style:italic"></span>  <span style="color:#069;font-weight:bold">AND</span> TLF.AUTH_TYP <span style="color:#069;font-weight:bold">IN</span> (<span style="color:#069;font-weight:bold">SELECT</span> MSG_TYP <span style="color:#069;font-weight:bold">FROM</span> TBP_ATM_MSG_TYP <span style="color:#069;font-weight:bold">WHERE</span> FLAG <span style="color:#555">=</span> <span style="color:#c30">&#39;Y&#39;</span>)
  <span style="color:#069;font-weight:bold">AND</span> TLF.AUTH_TRAN_CDE_R <span style="color:#555">=</span> <span style="color:#c30">&#39;500000&#39;</span>
  <span style="color:#069;font-weight:bold">AND</span> TLF.Q1_UTIL_CDE <span style="color:#069;font-weight:bold">IN</span> (<span style="color:#069;font-weight:bold">SELECT</span> UTIL_CDE <span style="color:#069;font-weight:bold">FROM</span> TBP_ATM_UTIL_CDE <span style="color:#069;font-weight:bold">WHERE</span> FLAG <span style="color:#555">=</span> <span style="color:#c30">&#39;Y&#39;</span>)
<span style="color:#069;font-weight:bold">GROUP</span> <span style="color:#069;font-weight:bold">BY</span> 
  TLF.FILE_NAME,
  TLF.AUTH_TYP,
  SUBSTR(TLF.AUTH_TRAN_CDE_R, <span style="color:#f60">1</span>, <span style="color:#f60">2</span>),
  TLF.AUTH_RESPONDER,
  TLF.AUTH_ORIGINATOR, 
  TLF.Q1_UTIL_CDE</code></pre></div></p>

<p>Execute the query, oracle working explain plan will return <code>Explained.</code></p>

<p>To check the result, execute below query:</p>

<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#069;font-weight:bold">SELECT</span> <span style="color:#555">*</span> <span style="color:#069;font-weight:bold">FROM</span> <span style="color:#069;font-weight:bold">TABLE</span>(DBMS_XPLAN.DISPLAY);</code></pre></div>

<p>The result will look like this:</p>

<pre><code class="language-sql">Plan hash value: 947008351
 
-----------------------------------------------------------------------------------------------------
| Id  | Operation                      | Name               | Rows  | Bytes | Cost (%CPU)| Time     |
-----------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT               |                    |     1 |    68 | 16605   (2)| 00:03:20 |
|   1 |  HASH GROUP BY                 |                    |     1 |    68 | 16605   (2)| 00:03:20 |
|   2 |   NESTED LOOPS                 |                    |     1 |    68 | 16604   (2)| 00:03:20 |
|   3 |    NESTED LOOPS                |                    |     1 |    61 | 16603   (2)| 00:03:20 |
|*  4 |     TABLE ACCESS FULL          | TLF                |    35 |  1890 | 16601   (2)| 00:03:20 |
|*  5 |     TABLE ACCESS BY INDEX ROWID| TBP_ATM_UTIL_CDE   |     1 |     7 |     1   (0)| 00:00:01 |
|*  6 |      INDEX UNIQUE SCAN         | TBP_UTIL_CDE_PK    |     1 |       |     0   (0)| 00:00:01 |
|*  7 |    TABLE ACCESS BY INDEX ROWID | TBP_ATM_MSG_TYP    |     1 |     7 |     1   (0)| 00:00:01 |
|*  8 |     INDEX UNIQUE SCAN          | TBP_ATM_MSG_TYP_PK |     1 |       |     0   (0)| 00:00:01 |
-----------------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   4 - filter(&quot;TLF&quot;.&quot;AUTH_TRAN_CDE_R&quot;='500000' AND &quot;TLF&quot;.&quot;Q1_UTIL_CDE&quot; IS NOT NULL AND 
              &quot;TLF&quot;.&quot;AUTH_TYP&quot; IS NOT NULL AND SUBSTR(&quot;TLF&quot;.&quot;FILE_NAME&quot;,-6)='160907' AND 
              &quot;TLF&quot;.&quot;HEAD_REC_TYP&quot;='01' AND SUBSTR(&quot;TLF&quot;.&quot;AUTH_TRAN_CDE_R&quot;,1,2)='50')
   5 - filter(&quot;FLAG&quot;='Y')
   6 - access(&quot;TLF&quot;.&quot;Q1_UTIL_CDE&quot;=&quot;UTIL_CDE&quot;)
   7 - filter(&quot;FLAG&quot;='Y')
   8 - access(&quot;TLF&quot;.&quot;AUTH_TYP&quot;=&quot;MSG_TYP&quot;)
</code></pre>

<p>you can <code>explain plain</code> using oracle sql developer. select your query then press <kbd>F10</kbd></p>

<p>if you use oracle sql developer, the result preview will be like this
<img src="/img/posts/explain-plan-result-sqldeveloper.png" alt="Explain plan plain" /></p>

<p>As seen in blocquotes and image. Oracle will do full scanning to TLF table, imagine oracle will read all that million
data everytime the procedure executed.
One of things, that easiest to do to tweak that query, is <strong>indexing</strong>.</p>

<p>Indexing is like creating a &lsquo;table of contents&rsquo;
in document. So, if you want to find the chapter you want to read, you dont need to read all the contents first. That
&lsquo;table of contents&rsquo; you made will guide you to the right chapter you want to read directly.</p>

<blockquote>
<p>Tips: I will avoid to write &lsquo;LIKE&rsquo; condition with &lsquo;%&rsquo; as prefix, specifically like &lsquo;%blabla&rsquo;, your indexing will useless. Ask why?</p>
</blockquote>

<h3 id="3-indexing">3. Indexing</h3>

<p>wip&hellip;</p>

<h3 id="4-find-tuning-advisor">4. find tuning advisor</h3>

<p>wip&hellip;</p>
         
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="https://rezadwi10.github.io/js/jquery.min.js"></script>
<script src="https://rezadwi10.github.io/js/bootstrap.min.js"></script>
<script src="https://rezadwi10.github.io/js/jquery.cookie.js"> </script>
<script src="https://rezadwi10.github.io/js/ekko-lightbox.js"></script>
<script src="https://rezadwi10.github.io/js/jquery.scrollTo.min.js"></script>
<script src="https://rezadwi10.github.io/js/masonry.pkgd.min.js"></script>
<script src="https://rezadwi10.github.io/js/imagesloaded.pkgd.min.js"></script>
<script src="https://rezadwi10.github.io/js/owl.carousel.min.js"></script>
<script src="https://rezadwi10.github.io/js/front.js"></script>



</body>
</html>
